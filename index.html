<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fahrtenbuch">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- App Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">

    <title>Fahrtenbuch</title>

    <!-- CSS -->
    <link rel="stylesheet" href="./css/themes.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="back-button hidden" id="backButton" aria-label="Zurück">
                <!-- Dein neues SVG (optimiert) -->
                <svg width="12" height="17" viewBox="0 0 12.3926 16.9629" xmlns="http://www.w3.org/2000/svg"
                    style="pointer-events: none;">
                    <path
                        d="M0 8.47656C0 8.7207 0.0878906 8.93555 0.273438 9.12109L8.01758 16.6895C8.18359 16.8652 8.39844 16.9531 8.65234 16.9531C9.16016 16.9531 9.55078 16.5723 9.55078 16.0645C9.55078 15.8105 9.44336 15.5957 9.28711 15.4297L2.17773 8.47656L9.28711 1.52344C9.44336 1.35742 9.55078 1.13281 9.55078 0.888672C9.55078 0.380859 9.16016 0 8.65234 0C8.39844 0 8.18359 0.0878906 8.01758 0.253906L0.273438 7.83203C0.0878906 8.00781 0 8.23242 0 8.47656Z"
                        fill="currentColor" />
                </svg>
            </button>

            <h1>Fahrtenbuch</h1>

            <!-- HIER IST DER NEUE BUTTON: -->
            <button class="settings-icon" id="settingsButton" aria-label="Einstellungen">
                <svg width="20" height="20" viewBox="0 0 20.0391 16.6504" xmlns="http://www.w3.org/2000/svg"
                    style="pointer-events: none;">
                    <path
                        d="M13.3398 16.6504C14.6289 16.6504 15.6836 15.5957 15.6836 14.3066C15.6836 13.0176 14.6289 11.9629 13.3398 11.9629C12.0508 11.9629 10.9863 13.0176 10.9863 14.3066C10.9863 15.5957 12.0508 16.6504 13.3398 16.6504ZM13.3398 15.4492C12.6953 15.4492 12.1973 14.9414 12.1973 14.3066C12.1973 13.6523 12.6953 13.1641 13.3398 13.1641C13.9844 13.1641 14.4824 13.6523 14.4824 14.3066C14.4824 14.9414 13.9844 15.4492 13.3398 15.4492ZM11.7871 13.5156L0.78125 13.5156C0.341797 13.5156 0 13.8672 0 14.3066C0 14.7461 0.341797 15.0879 0.78125 15.0879L11.7871 15.0879ZM18.9258 13.5156L15.0391 13.5156L15.0391 15.0879L18.9258 15.0879C19.3262 15.0879 19.6777 14.7461 19.6777 14.3066C19.6777 13.8672 19.3262 13.5156 18.9258 13.5156ZM6.44531 10.6934C7.73438 10.6934 8.78906 9.62891 8.78906 8.33984C8.78906 7.05078 7.73438 5.99609 6.44531 5.99609C5.15625 5.99609 4.10156 7.05078 4.10156 8.33984C4.10156 9.62891 5.15625 10.6934 6.44531 10.6934ZM6.44531 9.48242C5.81055 9.48242 5.30273 8.97461 5.30273 8.33984C5.30273 7.69531 5.81055 7.19727 6.44531 7.19727C7.08984 7.19727 7.58789 7.69531 7.58789 8.33984C7.58789 8.97461 7.08984 9.48242 6.44531 9.48242ZM0.742188 7.54883C0.341797 7.54883 0 7.90039 0 8.33984C0 8.7793 0.341797 9.12109 0.742188 9.12109L4.76562 9.12109L4.76562 7.54883ZM18.8867 7.54883L7.99805 7.54883L7.99805 9.12109L18.8867 9.12109C19.3262 9.12109 19.6777 8.7793 19.6777 8.33984C19.6777 7.90039 19.3262 7.54883 18.8867 7.54883ZM13.3398 4.7168C14.6289 4.7168 15.6836 3.66211 15.6836 2.37305C15.6836 1.08398 14.6289 0.0195312 13.3398 0.0195312C12.0508 0.0195312 10.9863 1.08398 10.9863 2.37305C10.9863 3.66211 12.0508 4.7168 13.3398 4.7168ZM13.3398 3.51562C12.6953 3.51562 12.1973 3.00781 12.1973 2.36328C12.1973 1.71875 12.6953 1.2207 13.3398 1.2207C13.9844 1.2207 14.4824 1.71875 14.4824 2.36328C14.4824 3.00781 13.9844 3.51562 13.3398 3.51562ZM11.8359 1.5918L0.78125 1.5918C0.341797 1.5918 0 1.93359 0 2.37305C0 2.8125 0.341797 3.16406 0.78125 3.16406L11.8359 3.16406ZM18.9258 1.5918L14.9023 1.5918L14.9023 3.16406L18.9258 3.16406C19.3262 3.16406 19.6777 2.8125 19.6777 2.37305C19.6777 1.93359 19.3262 1.5918 18.9258 1.5918Z"
                        fill="currentColor" />
                </svg>
            </button>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Setup Card -->
            <div id="setupCard" class="card">
                <h2>Initialer KM-Stand</h2>
                <div class="input-group">
                    <label>Aktueller Kilometerstand</label>
                    <input type="number" id="initialKm" placeholder="z.B. 45000" inputmode="numeric">
                </div>
                <button class="action-button start-button" id="saveInitialKmBtn">Speichern</button>
            </div>

            <!-- Main App Card -->
            <div id="mainCard" class="card hidden">
                <div class="km-display">
                    <div class="label">Aktueller KM-Stand</div>
                    <div class="value" id="currentKm">0</div>
                </div>

                <!-- Active Trip Display -->
                <div id="activeTripDisplay" class="active-trip hidden">
                    <div class="active-trip-info">
                        <div>
                            <strong>Fahrt läuft...</strong>
                            <div id="activeTripType" style="font-size: 14px; color: #666;"></div>
                            <div id="activeTripStart" style="font-size: 14px; color: #666;"></div>
                        </div>
                    </div>
                </div>

                <!-- Start Trip Section -->
                <div id="startSection">
                    <h2>Neue Fahrt</h2>
                    <div class="trip-type">
                        <button id="businessBtn" class="active">Dienstlich</button>
                        <button id="privateBtn">Privat</button>
                        <div class="glider"></div>
                    </div>
                    <div class="input-group">
                        <label>Notiz (optional)</label>
                        <textarea id="tripNote" placeholder="z.B. Kundenbesuch, Einkauf..."></textarea>
                    </div>
                    <button class="action-button start-button" id="startTripBtn">Fahrt starten</button>
                </div>

                <!-- End Trip Section -->
                <div id="endSection" class="hidden">
                    <h2>Fahrt beenden</h2>
                    <div class="input-group">
                        <label>KM-Stand am Ende</label>
                        <input type="number" id="endKm" placeholder="z.B. 45120" inputmode="numeric">
                    </div>
                    <button class="action-button stop-button" id="endTripBtn">Fahrt beenden</button>
                </div>
            </div>

            <!-- Summary Card -->
            <div id="summaryCard" class="card hidden">
                <h2>Übersicht</h2>

                <!-- 1. Slider mit 3 Optionen -->
                <div class="trip-type summary-toggle" style="margin-bottom: 25px;">
                    <button id="summaryWeekBtn" class="active">Woche</button>
                    <button id="summaryMonthBtn">Monat</button> <!-- NEU -->
                    <button id="summaryTotalBtn">Gesamt</button>
                    <div class="glider"></div>
                </div>

                <!-- 2. Großes "Hero" Display für Gesamt -->
                <div class="summary-hero">
                    <div class="label" id="summaryTitleLabel">Gesamtstrecke</div>
                    <div class="value" id="totalKm">0 km</div>
                </div>

                <!-- 3. Aufteilung Dienstlich / Privat -->
                <div class="summary-split">
                    <div class="summary-item">
                        <div class="label">Dienstlich</div>
                        <div class="value" id="businessKm">0 km</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Privat</div>
                        <div class="value" id="privateKm">0 km</div>
                    </div>
                </div>

                <button class="action-button export-button" id="goToExportBtn" style="margin-top: 20px;">
                    Daten exportieren
                </button>
            </div>

            <!-- Trip List Card -->
            <div id="tripListCard" class="card hidden">
                <h2>Fahrten</h2>
                <div class="trip-list" id="tripList">
                    <div class="empty-state">Noch keine Fahrten aufgezeichnet</div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsContent" class="hidden">
            <div class="card">
                <h2>Einstellungen</h2>

                <div class="settings-section">
                    <h3>KM-Stand anpassen</h3>
                    <div class="input-group">
                        <label>Aktueller KM-Stand</label>
                        <input type="number" id="editCurrentKm" placeholder="z.B. 45000" inputmode="numeric">
                    </div>
                    <button class="action-button export-button" id="updateKmBtn">KM-Stand aktualisieren</button>
                </div>

                <div class="settings-section">
                    <h3>Darstellung</h3>
                    <div class="input-group">
                        <label>Design</label>
                        <select id="themeSelect">
                            <option value="system">System (Automatisch)</option>
                            <option value="light">Hell</option>
                            <option value="dark">Dunkel</option>
                            <option value="pastel">Pastel</option>
                            <option value="midnight">Mitternacht</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Daten exportieren</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Exportiere deine Fahrten als
                        CSV-Datei.</p>

                    <!-- ÄNDERUNG: Zwei Buttons untereinander -->
                    <button class="action-button export-button" id="exportBtn2">
                        Alle Fahrten (Detailliert)
                    </button>

                    <button class="action-button export-button" id="exportWeeklyBtn" style="margin-top: 10px;">
                        Wochenbericht (Zusammenfassung)
                    </button>
                </div>

                <div class="settings-section danger-zone">
                    <h3 style="color: var(--danger-color);">Gefahrenzone</h3>
                    <p style="color: #666; margin-bottom: 15px;">Diese Aktionen können nicht rückgängig gemacht werden!
                    </p>
                    <button class="action-button stop-button" id="clearTripsBtn">Alle Fahrten löschen</button>
                    <button class="action-button stop-button" id="resetAppBtn" style="margin-top: 10px;">App komplett
                        zurücksetzen</button>
                </div>

                <button class="action-button button-secondary" id="closeSettingsBtn">Zurück</button>

                <div style="text-align: center;">
                    <label style="color:#666;">entwickelt von Philipp</label><br>
                    <label style="color:#666;">11.12.2025</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Trip Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Fahrt bearbeiten</h2>
                <button class="close-button" id="closeEditModalBtn">&times;</button>
            </div>

            <div class="trip-type">
                <button id="editBusinessBtn">Dienstlich</button>
                <button id="editPrivateBtn">Privat</button>
                <div class="glider"></div>
            </div>

            <div class="input-group">
                <label>Start KM</label>
                <input type="number" id="editStartKm" inputmode="numeric">
            </div>

            <div class="input-group">
                <label>Ende KM</label>
                <input type="number" id="editEndKm" inputmode="numeric">
            </div>

            <div class="input-group">
                <label>Notiz (optional)</label>
                <textarea id="editTripNote" placeholder="z.B. Kundenbesuch, Einkauf..."></textarea>
            </div>
            <!-- Button Gruppe für Abbrechen/Speichern -->
            <div class="button-group" style="margin-top: 20px;">
                <button class="action-button button-secondary" id="cancelEditBtn">Abbrechen</button>
                <button class="action-button export-button" id="saveEditBtn">Speichern</button>
            </div>

            <!-- Neuer Löschen-Button (Darunter, volle Breite, rot) -->
            <button class="action-button stop-button" id="modalDeleteBtn"
                style="margin-top: 15px; background-color: var(--danger-color);">
                Fahrt löschen
            </button>
        </div>
    </div>

    <!-- JavaScript Files - Reihenfolge ist wichtig! -->
    <script src="./js/storage.js"></script>
    <script src="./js/tripManager.js"></script>
    <script src="./js/ui.js"></script>
    <script src="./js/app.js"></script>
</body>

</html>