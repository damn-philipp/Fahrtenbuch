<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- PWA Settings: Entfernt Browser-Leisten -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Statusbar: Transparenter Hintergrund (Inhalt rutscht dahinter) -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fahrtenbuch">

    <!-- NEU: Definiert die Farbe für Browser & Android Statusbar -->
    <!-- Light Mode: Dein System-Grau -->
    <meta name="theme-color" content="#F2F2F7" media="(prefers-color-scheme: light)">
    <!-- Dark Mode: Dein System-Schwarz -->
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">

    <!-- App Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">

    <title>Fahrtenbuch</title>

    <!-- CSS -->
    <link rel="stylesheet" href="./css/themes.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="back-button hidden" id="backButton" aria-label="Zurück">
                <!-- Dein neues SVG (optimiert) -->
                <svg width="12" height="17" viewBox="0 0 12.3926 16.9629" xmlns="http://www.w3.org/2000/svg"
                    style="pointer-events: none;">
                    <path
                        d="M0 8.47656C0 8.7207 0.0878906 8.93555 0.273438 9.12109L8.01758 16.6895C8.18359 16.8652 8.39844 16.9531 8.65234 16.9531C9.16016 16.9531 9.55078 16.5723 9.55078 16.0645C9.55078 15.8105 9.44336 15.5957 9.28711 15.4297L2.17773 8.47656L9.28711 1.52344C9.44336 1.35742 9.55078 1.13281 9.55078 0.888672C9.55078 0.380859 9.16016 0 8.65234 0C8.39844 0 8.18359 0.0878906 8.01758 0.253906L0.273438 7.83203C0.0878906 8.00781 0 8.23242 0 8.47656Z"
                        fill="currentColor" />
                </svg>
            </button>

            <h1>Fahrtenbuch</h1>

            <!-- HIER IST DER NEUE BUTTON: -->
            <button class="settings-icon" id="settingsButton" aria-label="Einstellungen">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    viewBox="0 0 21.9531 21.3011" width="20" height="20">
                    <g>
                        <rect height="21.3011" opacity="0" width="21.9531" x="0" y="0" />
                        <path
                            d="M10.791 19.9816C11.0352 19.9816 11.2695 19.9718 11.5039 19.9523L12.041 20.9582C12.168 21.2121 12.3926 21.3097 12.666 21.2804C12.9492 21.2316 13.1152 21.0461 13.1445 20.7726L13.3105 19.6398C13.7793 19.5129 14.2188 19.3468 14.6484 19.1515L15.4883 19.9132C15.6934 20.1086 15.9473 20.1183 16.1914 19.9914C16.4355 19.8546 16.5332 19.6203 16.4746 19.3468L16.2305 18.2336C16.6211 17.9601 16.9824 17.6476 17.3242 17.3254L18.3691 17.755C18.6328 17.8527 18.877 17.7941 19.0625 17.5793C19.248 17.3644 19.2676 17.1203 19.1113 16.8761L18.5059 15.9191C18.7695 15.5187 19.0039 15.1086 19.2188 14.6886L20.3418 14.7277C20.625 14.7375 20.8398 14.6007 20.9375 14.3273C21.0352 14.0734 20.9668 13.8293 20.7422 13.6632L19.834 12.9699C19.9609 12.5109 20.0391 12.0421 20.0879 11.5539L21.1621 11.2121C21.4355 11.1242 21.5918 10.9289 21.5918 10.6457C21.5918 10.3625 21.4355 10.1574 21.1621 10.0793L20.0879 9.73746C20.0391 9.24918 19.9609 8.78043 19.834 8.32145L20.7324 7.62809C20.9668 7.46207 21.0254 7.21793 20.9375 6.95426C20.8398 6.68082 20.625 6.55387 20.3418 6.56363L19.2188 6.59293C19.0039 6.17301 18.7695 5.75309 18.5059 5.36246L19.1016 4.4152C19.2578 4.17105 19.2383 3.91715 19.0723 3.7023C18.877 3.48746 18.6328 3.43863 18.3789 3.53629L17.3242 3.96598C16.9824 3.62418 16.6113 3.32145 16.2305 3.04801L16.4746 1.94449C16.5332 1.66129 16.4355 1.43668 16.2012 1.29996C15.9473 1.15348 15.6934 1.19254 15.4883 1.37809L14.6387 2.13004C14.2188 1.93473 13.7695 1.77848 13.3008 1.64176L13.1445 0.518711C13.1152 0.245273 12.9395 0.0694922 12.6758 0.0108985C12.3926-0.0379296 12.168 0.0792579 12.041 0.323398L11.5039 1.32926C11.2695 1.31949 11.0352 1.30973 10.791 1.30973C10.5566 1.30973 10.3223 1.31949 10.0781 1.32926L9.55078 0.333164C9.41406 0.0792579 9.18945-0.028164 8.92578 0.0108985C8.64258 0.0597266 8.47656 0.245273 8.4375 0.518711L8.27148 1.64176C7.8125 1.77848 7.36328 1.94449 6.93359 2.1398L6.10352 1.37809C5.89844 1.18277 5.64453 1.16324 5.39062 1.29996C5.14648 1.43668 5.05859 1.67105 5.11719 1.94449L5.35156 3.05777C4.96094 3.33121 4.59961 3.63395 4.25781 3.96598L3.21289 3.53629C2.95898 3.42887 2.70508 3.49723 2.51953 3.71207C2.33398 3.91715 2.32422 4.17105 2.48047 4.4152L3.08594 5.37223C2.8125 5.76285 2.57812 6.18277 2.37305 6.6027L1.25 6.56363C0.957031 6.5441 0.751953 6.69059 0.654297 6.95426C0.546875 7.21793 0.625 7.46207 0.849609 7.62809L1.74805 8.32145C1.63086 8.78043 1.54297 9.24918 1.50391 9.73746L0.419922 10.0793C0.146484 10.1574 0 10.3625 0 10.6457C0 10.9289 0.146484 11.1242 0.419922 11.2121L1.50391 11.5539C1.54297 12.0421 1.63086 12.5109 1.74805 12.9699L0.849609 13.6632C0.625 13.8293 0.566406 14.0734 0.644531 14.3371C0.751953 14.6105 0.957031 14.7375 1.24023 14.7277L2.37305 14.6886C2.57812 15.1183 2.8125 15.5285 3.08594 15.9289L2.48047 16.8761C2.32422 17.1203 2.35352 17.3742 2.51953 17.5793C2.71484 17.8039 2.95898 17.8527 3.21289 17.755L4.25781 17.3156C4.59961 17.6574 4.9707 17.9601 5.35156 18.2433L5.11719 19.3468C5.05859 19.6203 5.15625 19.8546 5.39062 19.9914C5.64453 20.1379 5.89844 20.1086 6.09375 19.9132L6.94336 19.1515C7.37305 19.3566 7.82227 19.5129 8.28125 19.6398L8.4375 20.7629C8.47656 21.0461 8.65234 21.2218 8.91602 21.2804C9.19922 21.3293 9.41406 21.2121 9.55078 20.9582L10.0781 19.9523C10.3223 19.9718 10.5566 19.9816 10.791 19.9816ZM10.791 18.3605C6.5332 18.3605 3.07617 14.9035 3.07617 10.6457C3.07617 6.37809 6.5332 2.93082 10.791 2.93082C15.0586 2.93082 18.5059 6.37809 18.5059 10.6457C18.5059 14.9035 15.0586 18.3605 10.791 18.3605ZM9.0918 9.15152L10.2441 8.4191L6.98242 2.8234L5.78125 3.49723ZM12.9688 11.3097L19.4629 11.3097L19.4629 9.96207L12.9688 9.96207ZM10.2637 12.9015L9.12109 12.1593L5.68359 17.7648L6.875 18.4679ZM10.8008 13.2043C12.2168 13.2043 13.3594 12.0617 13.3594 10.6457C13.3594 9.22965 12.2168 8.08707 10.8008 8.08707C9.38477 8.08707 8.24219 9.22965 8.24219 10.6457C8.24219 12.0617 9.38477 13.2043 10.8008 13.2043ZM10.8008 11.7394C10.1953 11.7394 9.70703 11.2511 9.70703 10.6457C9.70703 10.0402 10.1953 9.55191 10.8008 9.55191C11.4062 9.55191 11.8945 10.0402 11.8945 10.6457C11.8945 11.2511 11.4062 11.7394 10.8008 11.7394Z"
                            fill="currentColor" />
                    </g>
                </svg>
            </button>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Setup Card -->
            <div id="setupCard" class="card">
                <h2>Initialer KM-Stand</h2>
                <div class="input-group">
                    <label>Aktueller Kilometerstand</label>
                    <input type="number" id="initialKm" placeholder="z.B. 45000" inputmode="numeric">
                </div>
                <button class="action-button start-button" id="saveInitialKmBtn">Speichern</button>
            </div>

            <!-- Main App Card -->
            <div id="mainCard" class="card hidden">
                <div class="km-display">
                    <div class="label">Aktueller KM-Stand</div>
                    <div class="value" id="currentKm">0</div>
                </div>

                <!-- Active Trip Display -->
                <div id="activeTripDisplay" class="active-trip hidden">
                    <div class="active-trip-info">
                        <div>
                            <strong>Fahrt läuft...</strong>
                            <div id="activeTripType" style="font-size: 14px; color: #666;"></div>
                            <div id="activeTripStart" style="font-size: 14px; color: #666;"></div>
                        </div>
                    </div>
                </div>

                <!-- Start Trip Section -->
                <div id="startSection">
                    <h2>Neue Fahrt</h2>
                    <div class="trip-type">
                        <button id="businessBtn" class="active">Dienstlich</button>
                        <button id="privateBtn">Privat</button>
                        <div class="glider"></div>
                    </div>
                    <div class="input-group">
                        <label>Notiz (optional)</label>
                        <textarea id="tripNote" placeholder="z.B. Kundenbesuch, Einkauf..."></textarea>
                    </div>
                    <button class="action-button start-button" id="startTripBtn">Fahrt starten</button>
                </div>

                <!-- End Trip Section -->
                <div id="endSection" class="hidden">
                    <h2>Fahrt beenden</h2>
                    <div class="input-group">
                        <label>KM-Stand am Ende</label>
                        <input type="number" id="endKm" placeholder="z.B. 45120" inputmode="numeric">
                    </div>
                    <button class="action-button stop-button" id="endTripBtn">Fahrt beenden</button>
                </div>
            </div>

            <!-- Summary Card -->
            <div id="summaryCard" class="card hidden">
                <h2>Übersicht</h2>

                <!-- 1. Slider mit 3 Optionen -->
                <div class="trip-type summary-toggle" style="margin-bottom: 25px;">
                    <button id="summaryWeekBtn" class="active">Woche</button>
                    <button id="summaryMonthBtn">Monat</button> <!-- NEU -->
                    <button id="summaryTotalBtn">Gesamt</button>
                    <div class="glider"></div>
                </div>

                <!-- 2. Großes "Hero" Display für Gesamt -->
                <div class="summary-hero">
                    <div class="label" id="summaryTitleLabel">Gesamtstrecke</div>
                    <div class="value" id="totalKm">0 km</div>
                </div>

                <!-- 3. Aufteilung Dienstlich / Privat -->
                <div class="summary-split">
                    <div class="summary-item">
                        <div class="label">Dienstlich</div>
                        <div class="value" id="businessKm">0 km</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Privat</div>
                        <div class="value" id="privateKm">0 km</div>
                    </div>
                </div>

                <!-- Analyse-Bereich für Privatnutzung (nur bei Gesamt) -->
                <div id="privateAnalysis" class="summary-morph-container">
                    <div class="summary-split">
                        <div class="summary-item">
                            <div class="label">Kosten pro Privat-KM</div>
                            <div class="value" id="costPerKm">0,00 €</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">Gesamtkosten</div>
                            <div class="value" id="totalPrivateCost">0,00 €</div>
                        </div>
                    </div>
                </div>

                <button class="action-button export-button" id="goToExportBtn" style="margin-top: 20px;">
                    Daten exportieren
                </button>
            </div>

            <!-- Trip List Card -->
            <div id="tripListCard" class="card hidden">
                <h2>Fahrten</h2>
                <div class="trip-list" id="tripList">
                    <div class="empty-state">Noch keine Fahrten aufgezeichnet</div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsContent" class="hidden">
            <div class="card">
                <h2>Einstellungen</h2>

                <div class="settings-section">
                    <h3>Darstellung</h3>
                    <div class="input-group">
                        <label>Design</label>
                        <select id="themeSelect">
                            <option value="system">System (Automatisch)</option>
                            <option value="light">Hell</option>
                            <option value="dark">Dunkel</option>
                            <option value="pastel">Pastel</option>
                            <option value="midnight">Mitternacht</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>KM-Stand anpassen</h3>
                    <div class="input-group">
                        <label>Aktueller KM-Stand</label>
                        <input type="number" id="editCurrentKm" placeholder="z.B. 45000" inputmode="numeric">
                    </div>
                    <button class="action-button export-button" id="updateKmBtn">KM-Stand aktualisieren</button>
                </div>

                <div class="settings-section">
                    <h3>Privatnutzung</h3>
                    <div class="input-group">
                        <label>Monatlicher Preis (€)</label>
                        <input type="number" id="privatePrice" placeholder="251" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Startdatum</label>
                        <input type="date" id="startDate">
                    </div>
                    <button class="action-button export-button" id="savePrivateSettingsBtn">Einstellungen
                        speichern</button>
                </div>

                <div class="settings-section">
                    <h3>Daten exportieren</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Exportiere deine Fahrten als
                        CSV-Datei.</p>

                    <!-- ÄNDERUNG: Zwei Buttons untereinander -->
                    <button class="action-button export-button" id="exportBtn2">
                        Alle Fahrten (Detailliert)
                    </button>

                    <button class="action-button export-button" id="exportWeeklyBtn" style="margin-top: 10px;">
                        Wochenbericht (Zusammenfassung)
                    </button>
                </div>

                <div class="settings-section danger-zone">
                    <h3 style="color: var(--danger-color);">Gefahrenzone</h3>
                    <p style="color: #666; margin-bottom: 15px;">Diese Aktionen können nicht rückgängig gemacht werden!
                    </p>
                    <button class="action-button stop-button" id="clearTripsBtn">Alle Fahrten löschen</button>
                    <button class="action-button stop-button" id="resetAppBtn" style="margin-top: 10px;">App komplett
                        zurücksetzen</button>
                </div>

                <button class="action-button button-secondary" id="closeSettingsBtn">Zurück</button>

                <div style="text-align: center;">
                    <label style="color:#666;">entwickelt von Philipp</label><br>
                    <label style="color:#666;">11.12.2025</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Trip Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Fahrt bearbeiten</h2>
                <button class="close-button" id="closeEditModalBtn">&times;</button>
            </div>

            <div class="trip-type">
                <button id="editBusinessBtn">Dienstlich</button>
                <button id="editPrivateBtn">Privat</button>
                <div class="glider"></div>
            </div>

            <div class="input-group">
                <label>Start KM</label>
                <input type="number" id="editStartKm" inputmode="numeric">
            </div>

            <div class="input-group">
                <label>Ende KM</label>
                <input type="number" id="editEndKm" inputmode="numeric">
            </div>

            <div class="input-group">
                <label>Notiz (optional)</label>
                <textarea id="editTripNote" placeholder="z.B. Kundenbesuch, Einkauf..."></textarea>
            </div>
            <!-- Button Gruppe für Abbrechen/Speichern -->
            <div class="button-group" style="margin-top: 20px;">
                <button class="action-button button-secondary" id="cancelEditBtn">Abbrechen</button>
                <button class="action-button export-button" id="saveEditBtn">Speichern</button>
            </div>

            <!-- Neuer Löschen-Button (Darunter, volle Breite, rot) -->
            <button class="action-button stop-button" id="modalDeleteBtn"
                style="margin-top: 15px; background-color: var(--danger-color);">
                Fahrt löschen
            </button>
        </div>
    </div>

    <!-- JavaScript Files - Reihenfolge ist wichtig! -->
    <script src="./js/storage.js"></script>
    <script src="./js/tripManager.js"></script>
    <script src="./js/ui.js"></script>
    <script src="./js/app.js"></script>
</body>

</html>
<script src="./js/app.js"></script>